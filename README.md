# USTC BBS Attachment Archiver

（USTC 瀚海星云论坛内容与附件数字化归档工具）

## 项目简介

本项目用于对 **中国科学技术大学 WebVPN 访问下的 瀚海星云BBS 论坛** 中的帖子内容与附件进行自动化采集与本地归档。
 工具通过真实浏览器 + WebVPN 会话模拟，能够在保持合法访问权限的前提下，对论坛中的历史资料进行系统性保存，用于：

- 历史资料留存
- 影像、图文档案数字化
- 学校文化资产整理
- 个人合法备份与研究使用

该工具**不会绕过登录**，必须由用户本人在浏览器中手动登录 WebVPN 后才能运行。

------

## 核心功能

- 自动翻页遍历指定板块所有页面
- 自动进入帖子，定位真实附件 frame
- 使用浏览器下载机制（Playwright `expect_download`）稳定获取 `dn/sf` 附件
- 所有图片自动保存到本地统一文件夹
- 所有文字内容自动保存到本地word文档
- 支持断点续传（已处理帖子不会重复下载）

------

## 目录结构

运行后将生成：

```
WuShu_Archive/
└── images_all/          # 所有帖子附件图片
└── texts_all/          # 所有文字内容
download_progress.json       # 已处理帖子进度（附件）
crawl_progress.json 		# 已处理帖子进度（文字）
```

------

## 使用前准备

### 1. 安装环境

推荐使用 Conda：

```
conda create -n bbs_spider python=3.10
conda activate bbs_spider
pip install playwright beautifulsoup4 lxml python-docx
playwright install
```

------

### 2. 启动爬虫

```
python image_bbs.py
```

或者

```
python text_bbs.py
```

程程序启动后会打开一个真实浏览器窗口。

------

### 3. 手动操作步骤（非常重要）

1. 在浏览器中登录 **USTC WebVPN**

2. 进入到**WebVPN**蓝色界面后，在浏览器网址栏（**而非WebVPN的网址栏！**）输入：

   ```
   https://wvpn.ustc.edu.cn/http/77726476706e69737468656265737421f2f552d232237c53300d8db9d6562d/main.html
   ```

3. 进入 **BBS →指定板块（ 如 WuShu）**

4. 点击 **【第一页】**或指定页码

5. 回到终端按回车

之后程序将自动运行。

------

## 技术说明

本项目针对 USTC BBS + WebVPN 的特殊架构做了深度适配：

- WebVPN URL 重写（`http/777264...`）
- 多层 frames（`f3 / f5 / fmsg`）
- 老式 CGI 附件接口（`dn? / sf?`）
- WebVPN 下载反向代理

下载采用 **浏览器点击行为** 而不是 HTTP API 直接请求，以避免 WebVPN 后端返回 500/403 的问题。

------

## 版权与合法性声明

### 1. 论坛内容版权

BBS 板块中的：

- 文字内容
- 图片
- 附件
- 视频
- 作者署名

其 **著作权均归原作者或中国科学技术大学 BBS 系统所有**。
 本项目 **不会也不能转移任何版权**。

------

### 2. 本项目的用途边界

本项目仅用于：

- 本人账号可合法访问内容的本地备份
- 学术研究
- 校园文化与历史资料保存
- 内部档案整理

**严禁用于：**

- 商业传播
- 未经许可对外公开发布
- 二次分发或盈利
- 侵犯作者或学校权益的行为

------

### 3. 合法性原则

本工具遵循以下原则：

- 不提供、也不包含任何账号密码
- 不绕过登录、不破解权限
- 所有访问行为都在用户已登录 WebVPN 的前提下进行
- 等价于“你本人在浏览器中手动点击下载”

该工具只是 **自动化你本来就有权限进行的操作**。

------

## 责任声明

使用本工具即表示你理解并同意：

- 你对使用该工具产生的任何数据、存储、传播行为负责
- 作者不对使用者的不当使用承担任何法律责任

------

## 致谢

本项目用于保护和保存**中国科学技术大学瀚海星云BBS论坛历史资料**，避免由于论坛老化、服务器更换而造成宝贵影像与记录丢失。